= knloader English Manual
:author: kounch
:revnumber: 0.2.0
:doctype: book
:email: kounch@users.noreply.github.com
:Revision:  1.0
:description: English Manual for knloader
:keywords: Manual, English, knloader, ZX Spectrum Next, BASIC, Launcher
:icons: font 
:toc: left
:toc-title: Index
:toclevels: 4

<<<

== Description

Do you have a ZX Spectrum Next, but you are tired to remember which is the best option to launch your programs? knloader to the rescue!

This a set of NextBASIC programs which you can configure to remember, and then use, your preferred way to launch other programs (Next/+3e Mode, 128K mode, USR 0, etc.). As a bonus, you can put some images (like cassette covers or loading screens).

This program is not a replacement for the incoportaded Browser, nor offers any other function than to launch other programs.

== Requirements

=== Download

A ZIP file with the latest version is available following https://github.com/kounch/knloader/releases/latest[this link]

=== Software Requirements

- *NextZXOS (version 1.3.2)*. Docs, downloads, etc. [here](https://www.specnext.com/latestdistro/)

== Installation

Create manually `knloader.bdt` file using the text editor of your choice (see below for more instructions).

Copy together `knloader.bas`, `knlauncher`, `knzml` and the new `knloader.bdt` file to any place in your SD card.

== Use

Use the browser or command line to navigate to the folder where `knloader.bas`, `knlauncher` and `knloader.bdt` are. Load `knloader.bas`.

On first run, cache files will be created from the data inside database file `knloader.bdt`. This has to be done only once, or after any changes are made to the database file.

[.text-center] 
image::FirstBoot.png[pdfwidth=70%]

The main interface shows a list of the programs found in the database file.

[.text-center] 
image::CoverOff.png[pdfwidth=70%]

<<<

You can use the cursor keys or a joystick (Kempston or MD) to move and select the program that you want to load. Then, press `ENTER`, `0` or the joystick button to launch.

[.text-center] 
image::LoadDetails.png[pdfwidth=70%]

After a brief period of time, the program should load using the desired mode.

[.text-center] 
image::knlauncher.png[pdfwidth=70%]

<<<

If you have made a change to the database file, press R to rebuild the cache.

Press C or the joystick secondary button (in MD mode) to hide/show images.

[.text-center] 
image::CoverOn.png[pdfwidth=70%]

Press X to exit the program.

Press H to show some help.

== Database file format

The main database is stored in a text file (ANSI encoding), named `knloader.bdt`, and which has to be in the same directory where `knloader.bas` is in the SD card. At this moment, you have to create manually the database file.

All paths in the database file must use `/` (slash) as separator for directories. Using `\` (backslash) is not supported.

The first line has to be the base path where to start looking for programs (for example: `/games`). It's length cannot exceed 128 characters.

Starting from line 2, each line must have the following format:

[source]
----
Program Name,Loading Mode,<Directory>,File,<Image File>
----

Where each of the fields between ',' are as follows:

*`Program Name`*: Name to show in the interface (maximum 22 characters)

*`Loading Mode`*: A number indicating how to load the program file. Must be one of these:

    0  - 3DOS
    1  - TAP
    2  - TZX (fast)
    3  - DSK (AUTOBOOT)
    4  - TAP (USR 0)
    5  - TZX (USR0 - Fast)
    6  - TAP (Next)
    7  - TZX (Next - Fast)
    8  - DSK (Custom Boot)
    9  - TAP (PI Audio)
    10 - TZX
    11 - TAP (USR 0 - PI Audio)
    12 - TZX (USR 0)
    13 - TAP (PI Audio - Next)
    14 - TZX (Next)
    15 - NEX
    16 - Snapshot

[NOTE]
====
All TZX (fast) modes run at 14Mhz. Once the program is loaded, you can get back to 3.5MHz speed using the NMI menu or pressing NMI and 8 at the same time.

Mode 3 (DSK AUTOBOOT) will mount the DSK file at drive `A:` and execute `LOAD "*"`

Mode 8 (DSK Custom Boot) will mount the DSK file at drive `A:` and execute `LOAD "diskfile"`, where `diskfile` is obtained from the `File` field
====

<<<

*`Directory`*: (Optional) Subdirectory where file (optionally) and image file are located (maximum 64 characters)

*`File`*: Name of the file to execute (maximum 64 characters). If Mode 8 (DSK Custom Boot) is selected, it must have the name of both the DSK file and the file to load inside the disk image, separated by `:` (e.g. `Bounder.dsk:BOUNDER.BAS`)

*`Image File`*: (Optional) Name (maximum 64 characters) of a full screen image file to show behind the program listing. It can be in SCR, SLR, SHC, SL2 or BMP format.

=== Examples

This are all valid lines:

[source]
----
Albatrossity,1,,Albatrossity.tap

Alter Ego,4,Alter Ego,Alter Ego.tap

Altered Beast,3,Altered Beast,Altered Beast.dsk,Altered Beast.bmp

Astronut,16,../Next/,Astronut.snx
----

But these are not:

[source]
----
Albatrossity,,,Albatrossity.tap
----

(missing Load Mode Code)

[source]
----
,1,,Albatrossity.tap
----

(missing Name)

[source]
----
Albatrossity,1,,
----

(Missing File)

<<<

This is an example of a small database file:

[source]
----
/all/Games
Albatrossity,1,,Albatrossity.tap
Alter Ego,4,Alter Ego,Alter Ego.tap
Altered Beast,3,Altered Beast,Altered Beast.dsk,Altered Beast.bmp
Amaurote,2,Amaurote,Amaurote.tzx
Aquanoids,5,Aquanoids,Aquanoids.tzx
Auf Wiedersehen Monty,10,Auf Wiedersehen Monty,Auf Wiedersehen Monty - 128k.tzx
Astronut,16,../Next/,Astronut.snx
Barbarian: The Ultimate Warrior,0,Barbarian/3DOS,BARB.BAS,Barbarian.bmp
Batty,9,Batty,Batty.tap,
Bounder,8,Bounder,Bounder.dsk:BOUNDER.BAS
----

So, using this example, when you choose `Barbarian: The Ultimat` in the user interface, the program will try to load `/all/Games/Barbarian/3DOS/BARB.BAS`, and it will also try to show the image located at `/all/Games/Barbarian/3DOS/Barbarian.bmp`.

== Notes

This program creates a preferences file named `opts.tmp` inside the same folder where `knloader.bas` is installed.

It also creates a variable number of cache files inside `/tmp/knloader`. This is necessary to speed up the program execution and overcome RAM limitations for large database files. However, if the database file is not changed, these will become read only on all subsequent executions.

== Copyright

Copyright (c) 2020 kounch

Some of the code used to launch programs has been adapted from the official NextZXOS distribution (especifically from `browser.cfg`, `tapload.bas` and `tzxload.bas`).

**_Spectrum Next_** and **_System/Next_** are Â© **SpecNext Ltd**.

Permission to use, copy, modify, and/or distribute this software for any purpose with or without fee is hereby granted, provided that the above copyright notice and this permission notice appear in all copies.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE
